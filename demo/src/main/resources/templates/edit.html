<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ç¼–è¾‘ç¬”è®°</title>
    <link rel="stylesheet" href="/editor.md/css/editormd.min.css" />
    <style>
        #editormd { width: 90%; margin: 0 auto; }
        .save-btn { display: block; width: 120px; margin: 20px auto; padding: 10px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .title-input { width: 90%; margin: 10px auto; padding: 8px; display: block; }
    </style>
</head>
<body>
<h2 style="text-align:center;">âœï¸ ç¼–è¾‘ç¬”è®°</h2>

<form th:action="@{/save}" method="post">
    <!-- éšè—çš„ç¬”è®° IDï¼Œç”¨äºåŒºåˆ†æ–°å»º/æ›´æ–° -->
    <input type="hidden" name="id" th:value="${noteId}" />
    <!-- ç¬”è®°æ ‡é¢˜è¾“å…¥æ¡† -->
    <input type="text" name="title" class="title-input" th:value="${initTitle}" placeholder="ç¬”è®°æ ‡é¢˜" required />
    <!-- ç”¨äº Editor.md çš„éšè— textarea -->
    <textarea id="markdownContent" name="content" style="display:none;"></textarea>
    <!-- å°†åŸå§‹å†…å®¹æ”¾åœ¨ä¸€ä¸ªéšè—çš„ div ä¸­ (æ–¹æ¡ˆä¸€) -->
    <div id="init-content-holder" style="display:none;" th:text="${initContent}"></div>
    <!-- Editor.md å®¹å™¨ -->
    <div id="editormd"></div>
    <button type="submit" class="save-btn">ğŸ’¾ ä¿å­˜ç¬”è®°</button>
</form>

<script src="/jquery.min.js"></script>
<script src="/editor.md/editormd.min.js"></script>
<script>
    $(function() {
        // ä»éšè—çš„ div ä¸­è¯»å–å†…å®¹ï¼Œè¿™æ ·å¯ä»¥é¿å… JavaScript å­—ç¬¦ä¸²è½¬ä¹‰çš„é—®é¢˜
        var initContent = $('#init-content-holder').text();
        console.log("Initial Content from DOM:", initContent);

        var editor = editormd("editormd", {
            path: "/editor.md/lib/",
            height: 600,
            saveHTMLToTextarea: false,
            markdown: initContent, // ä½¿ç”¨ä» DOM è¯»å–çš„å†…å®¹
            onchange: function() {
                $("#markdownContent").val(this.getMarkdown());
            }
        });
    });
</script>
</body>
</html>