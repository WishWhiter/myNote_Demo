<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„ç¬”è®°</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; }
        ul { list-style-type: none; padding: 0; }
        li { padding: 8px 0; border-bottom: 1px solid #eee; }
        a { text-decoration: none; color: #0066cc; }
        .btn { display: inline-block; margin-top: 10px; padding: 8px 16px; background: #0066cc; color: white; text-decoration: none; border-radius: 4px; }
        .delete-btn { display: inline-block; margin-left: 10px; padding: 4px 8px; background: #dc3545; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9em; }
        .delete-btn:hover { background: #c82333; }
    </style>
</head>
<body>
<h1>ğŸ“ æˆ‘çš„ Markdown ç¬”è®°</h1>
<div style="position: absolute; top: 20px; right: 20px;">
    <!-- ä½¿ç”¨ Spring Security çš„ #authentication -->
    <span th:if="${#authentication != null and #authentication.name != null}" style="margin-right: 10px; color: #666;">
         æ¬¢è¿, <span th:text="${#authentication.name}">ç”¨æˆ·å</span>!
     </span>
    <!-- ç™»å‡ºé“¾æ¥ -->
    <form th:if="${#authentication != null and #authentication.name != null}" th:action="@{/logout}" method="post" style="display:inline;">
        <button type="submit" style="margin-right: 10px; color: #0066cc; text-decoration: none; background:none; border:none; cursor:pointer; padding:0;">ç™»å‡º</button>
    </form>
    <!-- ç™»å½•/æ³¨å†Œé“¾æ¥ (ä»…åœ¨æœªç™»å½•æ—¶æ˜¾ç¤º) -->
    <a th:if="${#authentication == null or #authentication.name == null}" href="/login" style="margin-right: 10px; color: #0066cc; text-decoration: none;">ç™»å½•</a>
    <a th:if="${#authentication == null or #authentication.name == null}" href="/register" style="color: #0066cc; text-decoration: none;">æ³¨å†Œ</a>
</div>

<ul>
    <li th:each="note : ${notes}">
        <a th:href="@{/view(id=${note.id})}" th:text="${note.title}">Note Title</a>
        |
        <a th:href="@{/edit(id=${note.id})}">ç¼–è¾‘</a>
        |
        <!-- åˆ é™¤æŒ‰é’® (ä½¿ç”¨ POST è¡¨å•) -->
        <form th:action="@{/delete}" method="post" style="display:inline;">
            <input type="hidden" name="id" th:value="${note.id}" />
            <!-- ä¿®æ”¹åçš„åˆ é™¤æŒ‰é’®ï¼šä½¿ç”¨ th:data-title ä¼ é€’æ ‡é¢˜ï¼Œonclick ä½¿ç”¨çº¯ JS è¯»å– -->
            <!-- ç¡®ä¿ button æ ‡ç­¾ç»“æ„æ¸…æ™°ï¼Œå±æ€§ä¹‹é—´æ²¡æœ‰é”™è¯¯ -->
            <button type="submit" class="delete-btn" th:data-title="${note.title}">åˆ é™¤</button>
        </form>
        <!-- æ·»åŠ ä¸€ä¸ªå°å‹çš„ JavaScript è„šæœ¬æ¥å¤„ç†ç¡®è®¤å¯¹è¯æ¡† -->
        <script th:inline="javascript">
            //<![CDATA[
            // è·å–å½“å‰å¾ªç¯ä¸­çš„ note.title (å®‰å…¨è½¬ä¹‰å)
            var noteTitle = /*[[${#strings.escapeJavaScript(note.title)}]]*/ '';
            // ä¸ºå½“å‰æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ (ä½¿ç”¨äº‹ä»¶å§”æ‰˜ä¼šæ›´é«˜æ•ˆï¼Œä½†è¿™é‡Œç®€å•å¤„ç†)
            // æ³¨æ„ï¼šè¿™æ®µè„šæœ¬åœ¨æ¯æ¬¡å¾ªç¯æ—¶éƒ½ä¼šæ‰§è¡Œï¼Œä½†åªä¼šä¿®æ”¹å½“å‰å¾ªç¯ç”Ÿæˆçš„æŒ‰é’®
            // æ›´å¥½çš„æ–¹å¼æ˜¯å°†äº‹ä»¶ç›‘å¬å™¨æ·»åŠ åˆ°çˆ¶å…ƒç´ ä¸Š
            document.addEventListener('DOMContentLoaded', function() {
                var deleteBtn = document.querySelector('form[action="/delete"] input[name="id"][value="' + /*[[${note.id}]]*/ '' + '"]').closest('form').querySelector('.delete-btn');
                if (deleteBtn) {
                    deleteBtn.onclick = function(event) {
                        // é˜»æ­¢è¡¨å•é»˜è®¤æäº¤
                        event.preventDefault();
                        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
                        if (confirm('ç¡®å®šåˆ é™¤ç¬”è®° "' + noteTitle + '" å—ï¼Ÿ')) {
                            // å¦‚æœç¡®è®¤ï¼Œåˆ™æäº¤è¡¨å•
                            this.closest('form').submit();
                        }
                        // å¦‚æœå–æ¶ˆï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
                    };
                }
            });
            //]]>
        </script>
    </li>
    <li th:if="${#lists.isEmpty(notes)}">æš‚æ— ç¬”è®°</li>
</ul>

<!-- æ–°å»ºç¬”è®°æŒ‰é’®ï¼šæ ¹æ®è®¤è¯çŠ¶æ€å†³å®šé“¾æ¥ -->
<a class="btn" th:href="${#authentication != null and #authentication.name != null ? '/edit' : '/login'}">+ æ–°å»ºç¬”è®°</a>
</body>
</html>